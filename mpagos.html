<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear Pago con Mercado Pago</title>
</head>
<body>
    <h1>Realizar Pago</h1>
    <form id="paymentForm">
        <label for="cardNumber">Número de Tarjeta:</label>
        <input type="text" id="cardNumber" name="cardNumber" required>

        <label for="cardExpirationMonth">Mes de Expiración:</label>
        <input type="text" id="cardExpirationMonth" name="cardExpirationMonth" required>

        <label for="cardExpirationYear">Año de Expiración:</label>
        <input type="text" id="cardExpirationYear" name="cardExpirationYear" required>

        <label for="cardholderName">Nombre del Titular:</label>
        <input type="text" id="cardholderName" name="cardholderName" required>

        <label for="securityCode">Código de Seguridad:</label>
        <input type="text" id="securityCode" name="securityCode" required>

        <label for="installments">Cuotas:</label>
        <input type="number" id="installments" name="installments" value="1" required>

        <label for="transactionAmount">Monto de la Transacción:</label>
        <input type="number" id="transactionAmount" name="transactionAmount" required>

        <input type="hidden" name="payment_method_id" value="visa">
        <input type="hidden" name="description" value="Compra en QuetzalArte">
        <input type="hidden" name="payer.email" value="test_user@testuser.com">

        <button type="submit">Pagar</button>
    </form>

    <script>
        document.getElementById('paymentForm').addEventListener('submit', function(event) {
            event.preventDefault();

            const cardNumber = document.getElementById('cardNumber').value;
            const cardExpirationMonth = document.getElementById('cardExpirationMonth').value;
            const cardExpirationYear = document.getElementById('cardExpirationYear').value;
            const cardholderName = document.getElementById('cardholderName').value;
            const securityCode = document.getElementById('securityCode').value;
            const installments = document.getElementById('installments').value;
            const transactionAmount = document.getElementById('transactionAmount').value;
            const payment_method_id = document.querySelector('input[name="payment_method_id"]').value;
            const description = document.querySelector('input[name="description"]').value;
            const payer_email = document.querySelector('input[name="payer.email"]').value;

            fetch('https://api.mercadopago.com/v1/payments', {
                method: 'POST',
                headers: {
                    'Authorization': 'APP_USR-6378641395478188-022700-b612599b847d64f48cce348679d2712b-74762859',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    token: '',  // Asume que tienes el token de la tarjeta
                    issuer_id: null,
                    payment_method_id: payment_method_id,
                    transaction_amount: Number(transactionAmount),
                    installments: Number(installments),
                    description: description,
                    payer: {
                        email: payer_email,
                        identification: {
                            type: 'DNI',
                            number: '12345678'
                        }
                    }
                })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Error en la respuesta de la API');
                }
                return response.json();
            })
            .then(data => {
                console.log(data);
                if (data.status === 'approved') {
                    alert('Pago aprobado');
                } else {
                    alert('Pago rechazado: ' + data.status_detail);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Ocurrió un error al procesar el pago.');
            });
        });
    </script>
</body>
</html>
