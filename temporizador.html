<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cuenta Regresiva Personalizable</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #1c1e26;
      color: #fff;
      text-align: center;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .container {
      background: linear-gradient(135deg, #292d3e, #3c415c);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5);
      width: 350px;
    }
    h1 {
      margin-top: 0;
      font-size: 24px;
    }
    .timer {
      font-size: 48px;
      font-weight: bold;
      margin: 20px 0;
      color: #5af78e;
    }
    #countdown-message {
      font-size: 48px;
      font-weight: bold;
      color: #ff5e00;
      margin-top: 10px;
      text-shadow: 0 0 10px rgba(255, 94, 0, 0.8), 0 0 20px rgba(255, 94, 0, 0.8);
      animation: blink 1s step-start 0s infinite;
    }
    #over-time {
      font-size: 20px;
      color: #ff4757;
      margin-top: 10px;
    }
    input {
      width: 50px;
      padding: 10px;
      margin: 5px;
      border: none;
      border-radius: 5px;
      background: #44475a;
      color: #fff;
      text-align: center;
    }
    button {
      background: linear-gradient(45deg, #4caf50, #00bcd4);
      color: #fff;
      padding: 10px 20px;
      margin-top: 10px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      transition: background 0.3s ease;
    }
    button:hover {
      background: linear-gradient(45deg, #00bcd4, #4caf50);
    }
    button:disabled {
      background: #6c757d;
      cursor: not-allowed;
    }
    @keyframes blink {
      50% {
        opacity: 0;
      }
    }
    #comienza {
      font-size: 24px;
      color: #1e90ff;
      font-weight: bold;
      margin-top: 20px;
    }
    #finalizado {
      font-size: 20px;
      color: #ff4757;
      margin-top: 20px;
      font-weight: bold;
    }
  </style>
</head>
<body>

<div class="container">
  <h1 onclick="location.reload()" style="cursor: pointer; color: gray;">Cuenta Regresiva</h1>

  <!-- Reloj en tiempo real -->
  <div id="reloj" style="font-size: 40px; margin-bottom: 20px;"></div>

  <!-- Cronómetro -->
  <div id="cronometro" style="font-size: 20px; margin-bottom: 20px; color: #5af78e;">00:00:00</div>

  <!-- Primer temporizador -->
  <div id="timer-a">
    <label for="hours1"></label>
    <input type="number" id="hours1" min="0" value="0">
    <label for="minutes1">|</label>
    <input type="number" id="minutes1" min="0" value="0">
    <label for="seconds1">|</label>
    <input type="number" id="seconds1" min="0" value="10">
  </div>

  <button onclick="iniciarCuentaRegresiva1()" id="btnTemporizador1">Iniciar Temporizador 1</button>

  <div class="timer" id="timer1" style="visibility:hidden;">00:00:00</div>
  <div id="countdown-message1"></div>
  <div id="over-time1"></div>

  <br><br>

  <!-- Segundo temporizador -->
  <div id="timer-b">
    <label for="hours2"></label>
    <input type="number" id="hours2" min="0" value="0">
    <label for="minutes2">|</label>
    <input type="number" id="minutes2" min="0" value="0">
    <label for="seconds2">|</label>
    <input type="number" id="seconds2" min="0" value="15">
  </div>

  <button onclick="iniciarCuentaRegresiva2()" id="btnTemporizador2" disabled>Iniciar Temporizador 2</button>

  <div class="timer" id="timer2" style="visibility:hidden;">00:00:00</div>
  <div id="countdown-message2"></div>
  <div id="over-time2"></div>

  <div id="comienza"></div> <!-- Mensaje de "Comienza" -->
  <div id="finalizado"></div> <!-- Mensaje final de que ambos temporizadores han terminado -->

  <!-- Campo de texto para anotaciones -->
  <textarea id="anotaciones" placeholder="Escribe tus anotaciones aquí..." rows="4" style="width: 100%; margin-top: 10px;"></textarea>
  <button onclick="guardarAnotaciones()" style="margin-top: 10px;">Guardar Anotaciones</button>
</div>

<script>
  let tiempoRestante1 = 0;
  let cuentaRegresiva1;
  let tiempoRestante2 = 0;
  let cuentaRegresiva2;
  let tiempoExcedido1 = 0;
  let cuentaExcedida1;
  let tiempoExcedido2 = 0;
  let cuentaExcedida2;
  let temporizador1Finalizado = false;
  let temporizador2Finalizado = false;

  // Guardar valores de los campos del temporizador en localStorage
  function guardarValoresTemporizador() {
    const horas1 = document.getElementById('hours1').value;
    const minutos1 = document.getElementById('minutes1').value;
    const segundos1 = document.getElementById('seconds1').value;

    const horas2 = document.getElementById('hours2').value;
    const minutos2 = document.getElementById('minutes2').value;
    const segundos2 = document.getElementById('seconds2').value;

    localStorage.setItem('temporizador1', JSON.stringify({ horas: horas1, minutos: minutos1, segundos: segundos1 }));
    localStorage.setItem('temporizador2', JSON.stringify({ horas: horas2, minutos: minutos2, segundos: segundos2 }));
  }

  // Restaurar valores de los campos del temporizador desde localStorage
  function restaurarValoresTemporizador() {
    const temporizador1 = JSON.parse(localStorage.getItem('temporizador1'));
    const temporizador2 = JSON.parse(localStorage.getItem('temporizador2'));

    if (temporizador1) {
      document.getElementById('hours1').value = temporizador1.horas || 0;
      document.getElementById('minutes1').value = temporizador1.minutos || 0;
      document.getElementById('seconds1').value = temporizador1.segundos || 0;
    }

    if (temporizador2) {
      document.getElementById('hours2').value = temporizador2.horas || 0;
      document.getElementById('minutes2').value = temporizador2.minutos || 0;
      document.getElementById('seconds2').value = temporizador2.segundos || 0;
    }
  }

  // Llamar a guardarValoresTemporizador cada vez que se cambie un valor en los campos
  document.addEventListener('DOMContentLoaded', () => {
    restaurarValoresTemporizador();

    document.getElementById('hours1').addEventListener('input', guardarValoresTemporizador);
    document.getElementById('minutes1').addEventListener('input', guardarValoresTemporizador);
    document.getElementById('seconds1').addEventListener('input', guardarValoresTemporizador);

    document.getElementById('hours2').addEventListener('input', guardarValoresTemporizador);
    document.getElementById('minutes2').addEventListener('input', guardarValoresTemporizador);
    document.getElementById('seconds2').addEventListener('input', guardarValoresTemporizador);
  });

  function iniciarCuentaRegresiva1() {
    if (temporizador1Finalizado) {
      alert("El temporizador 1 ya ha finalizado.");
      return;
    }

    clearInterval(cuentaRegresiva1);
    clearInterval(cuentaExcedida1);
    document.getElementById('over-time1').innerHTML = '';
    document.getElementById('countdown-message1').innerHTML = '';

    const horas = parseInt(document.getElementById('hours1').value) || 0;
    const minutos = parseInt(document.getElementById('minutes1').value) || 0;
    const segundos = parseInt(document.getElementById('seconds1').value) || 0;

    tiempoRestante1 = (horas * 3600) + (minutos * 60) + segundos;

    if (tiempoRestante1 > 0) {
      // Ocultar el contenedor del temporizador-a y el botón, mostrar timer1
      document.getElementById('timer-a').style.display = 'none';
      document.getElementById('btnTemporizador1').style.display = 'none';
      document.getElementById('timer1').style.visibility = 'visible';

      actualizarTimer1(tiempoRestante1);
      cuentaRegresiva1 = setInterval(() => {
        if (tiempoRestante1 <= 10 && tiempoRestante1 > 0) {
          mostrarCuentaRegresivaTexto1(tiempoRestante1);
          reproducirCuentaAtras(tiempoRestante1);
        }
        if (tiempoRestante1 === 0) {
          finalizarCuentaRegresiva1();
        }
        actualizarTimer1(tiempoRestante1);
        tiempoRestante1--;
      }, 1000);
    }
  }

  function iniciarCuentaRegresiva2() {
    if (temporizador2Finalizado) {
      alert("El temporizador 2 ya ha finalizado.");
      return;
    }

    if (temporizador1Finalizado) {
      clearInterval(cuentaRegresiva2);
      clearInterval(cuentaExcedida2);
      document.getElementById('over-time2').innerHTML = '';
      document.getElementById('countdown-message2').innerHTML = '';

      const horas = parseInt(document.getElementById('hours2').value) || 0;
      const minutos = parseInt(document.getElementById('minutes2').value) || 0;
      const segundos = parseInt(document.getElementById('seconds2').value) || 0;

      tiempoRestante2 = (horas * 3600) + (minutos * 60) + segundos;

      if (tiempoRestante2 > 0) {
        // Ocultar el contenedor del temporizador-b y el botón, mostrar timer2
        document.getElementById('timer-b').style.display = 'none';
        document.getElementById('btnTemporizador2').style.display = 'none';
        document.getElementById('timer2').style.visibility = 'visible';

        actualizarTimer2(tiempoRestante2);
        cuentaRegresiva2 = setInterval(() => {
          if (tiempoRestante2 <= 10 && tiempoRestante2 > 0) {
            mostrarCuentaRegresivaTexto2(tiempoRestante2);
            reproducirCuentaAtras(tiempoRestante2);
          }
          if (tiempoRestante2 === 0) {
            finalizarCuentaRegresiva2();
          }
          actualizarTimer2(tiempoRestante2);
          tiempoRestante2--;
        }, 1000);
      }
    } else {
      alert("Primero termina el Temporizador 1.");
    }
  }

  function mostrarCuentaRegresivaTexto1(segundos) {
    if (segundos <= 10 && segundos > 0) {
      document.getElementById('countdown-message1').innerHTML = segundos;
    }
  }

  function mostrarCuentaRegresivaTexto2(segundos) {
    if (segundos <= 10 && segundos > 0) {
      document.getElementById('countdown-message2').innerHTML = segundos;
    }
  }

  function reproducirCuentaAtras(segundos) {
    if (segundos <= 5 && segundos < 10) {
      let mensaje = `${segundos}`;
      hablar(mensaje);
    } else if (segundos === 0) {
      hablar("Tiempo finalizado");
    }
  }

  function hablar(texto) {
    const mensaje = new SpeechSynthesisUtterance(texto);
    mensaje.lang = 'es-ES';
    speechSynthesis.speak(mensaje);
  }

  function actualizarTimer1(segundos) {
    const horas = Math.floor(segundos / 3600);
    const minutos = Math.floor((segundos % 3600) / 60);
    const segundosRestantes = segundos % 60;
    document.getElementById('timer1').innerHTML =
      `${formatoTiempo(horas)}:${formatoTiempo(minutos)}:${formatoTiempo(segundosRestantes)}`;
  }

  function actualizarTimer2(segundos) {
    const horas = Math.floor(segundos / 3600);
    const minutos = Math.floor((segundos % 3600) / 60);
    const segundosRestantes = segundos % 60;
    document.getElementById('timer2').innerHTML =
      `${formatoTiempo(horas)}:${formatoTiempo(minutos)}:${formatoTiempo(segundosRestantes)}`;
  }

  function formatoTiempo(numero) {
    return numero < 10 ? `0${numero}` : numero;
  }

  function finalizarCuentaRegresiva1() {
    clearInterval(cuentaRegresiva1);
    document.getElementById('countdown-message1').innerHTML = '⏰ ¡Tiempo agotado!';
    document.getElementById('timer1').innerHTML = '00:00:00';
    hablar("Tiempo finalizado");
    tiempoExcedido1 = 0;
    temporizador1Finalizado = true;
    document.getElementById('btnTemporizador2').disabled = false; // Habilitar el botón del segundo temporizador
    document.getElementById('comienza').innerHTML = '¡Listo para iniciar Temporizador 2!'; // Mostrar mensaje de "Comienza"
    if (temporizador2Finalizado) {
      document.getElementById('finalizado').innerHTML = 'Ambos temporizadores han finalizado.'; // Mostrar cuando ambos han finalizado
    }
  }

  function finalizarCuentaRegresiva2() {
    clearInterval(cuentaRegresiva2);
    document.getElementById('countdown-message2').innerHTML = '⏰ ¡Tiempo agotado!';
    document.getElementById('timer2').innerHTML = '00:00:00';
    hablar("Tiempo finalizado");
    tiempoExcedido2 = 0;
    temporizador2Finalizado = true;
    document.querySelector("button").disabled = true;
    document.getElementById('comienza').innerHTML = 'Finalizdo Temporizador 2'; // Mostrar mensaje cuando se ha iniciado el segundo temporizador
    if (temporizador1Finalizado) {
      document.getElementById('finalizado').innerHTML = 'Ambos temporizadores han finalizado.';
    }
  }

  // Función para guardar las anotaciones en localStorage
  function guardarAnotaciones() {
    const anotaciones = document.getElementById('anotaciones').value;
    localStorage.setItem('anotaciones', anotaciones);
    alert('Anotaciones guardadas correctamente.');
  }

  // Cargar las anotaciones guardadas al cargar la página
  window.onload = function() {
    const anotacionesGuardadas = localStorage.getItem('anotaciones');
    if (anotacionesGuardadas) {
      document.getElementById('anotaciones').value = anotacionesGuardadas;
    }
  };

  // Función para actualizar el reloj en tiempo real en formato 12 horas con AM/PM
  function actualizarReloj() {
    const ahora = new Date();
    let horas = ahora.getHours();
    const minutos = formatoTiempo(ahora.getMinutes());
    const segundos = formatoTiempo(ahora.getSeconds());
    const ampm = horas >= 12 ? 'PM' : 'AM';

    // Convertir a formato de 12 horas
    horas = horas % 12;
    horas = horas ? horas : 12; // La hora 0 se convierte en 12

    document.getElementById('reloj').innerHTML = `${horas}:${minutos}:${segundos} ${ampm}`;
  }

  // Llamar a actualizarReloj cada segundo
  setInterval(actualizarReloj, 1000);

  // Cronómetro
  let segundosCronometro = 0;

  function actualizarCronometro() {
    segundosCronometro++;
    const horas = Math.floor(segundosCronometro / 3600);
    const minutos = Math.floor((segundosCronometro % 3600) / 60);
    const segundos = segundosCronometro % 60;

    document.getElementById('cronometro').innerHTML =
      `${formatoTiempo(horas)}:${formatoTiempo(minutos)}:${formatoTiempo(segundos)}`;
  }

  // Iniciar el cronómetro al cargar la página
  setInterval(actualizarCronometro, 1000);
</script>

</body>
</html>
