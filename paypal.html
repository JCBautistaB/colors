<!DOCTYPE html>
<html lang="es">
<head>
    <!-- Cargar el script de Google Pay -->
    <meta charset="UTF-8">
    <title>Integración de Google Pay</title>
    <script async src="https://pay.google.com/gp/p/js/pay.js" onload="onGooglePayLoaded()"></script>
    <script>
        // Función que se ejecuta cuando Google Pay se ha cargado
        function onGooglePayLoaded() {
            const paymentsClient = new google.payments.api.PaymentsClient({ environment: 'TEST' });
            const button = paymentsClient.createButton({ onClick: onGooglePayButtonClicked });
            document.getElementById('gpay-button').appendChild(button);
        }

        // Función que se ejecuta cuando se hace clic en el botón de Google Pay
        function onGooglePayButtonClicked() {
            const paymentDataRequest = {
                apiVersion: 2,
                apiVersionMinor: 0,
                allowedPaymentMethods: [{
                    type: 'CARD',
                    parameters: {
                        allowedAuthMethods: ['PAN_ONLY', 'CRYPTOGRAM_3DS'],
                        allowedCardNetworks: ['MASTERCARD', 'VISA']
                    },
                    tokenizationSpecification: {
                        type: 'PAYMENT_GATEWAY',
                        parameters: {
                            gateway: 'real_gateway',
                            gatewayMerchantId: 'REAL_MERCHANT_ID'
                        }
                    }
                }],
                merchantInfo: {
                    merchantId: 'BCR2DN4T76COJU2J',
                    merchantName: 'Example Merchant'
                },
                transactionInfo: {
                    totalPriceStatus: 'FINAL',
                    totalPrice: '1.00',
                    currencyCode: 'MXN',
                    countryCode: 'MX',
                    transactionId: '367390'
                }
            };

            const paymentsClient = new google.payments.api.PaymentsClient({ environment: 'TEST' });
            paymentsClient.loadPaymentData(paymentDataRequest).then(function(paymentData) {
                // Manejar la respuesta del pago
                console.log('Pago exitoso', paymentData);

                // Mostrar un mensaje de éxito
                alert('Pago aprobado exitosamente');
                // O insertar un mensaje en el DOM
                const successMessage = document.createElement('p');
                successMessage.textContent = 'Pago aprobado exitosamente. Por favor, sea paciente mientras verificamos su transacción manualmente.';
                document.body.appendChild(successMessage);

                // Datos adicionales
                const paymentMethodData = paymentData.paymentMethodData;
                const email = paymentData.email;
                const shippingAddress = paymentData.shippingAddress;
                const billingAddress = paymentData.billingAddress;

                console.log('Método de pago:', JSON.stringify(paymentMethodData, null, 2));
                console.log('Correo electrónico:', email);
                console.log('Dirección de envío:', JSON.stringify(shippingAddress, null, 2));
                console.log('Dirección de facturación:', JSON.stringify(billingAddress, null, 2));
            }).catch(function(err) {
                console.error('Error al procesar el pago', err);
            });
        }
    </script>
</head>
<body>
    <!-- Contenedor del botón de Google Pay -->
    <div id="gpay-button"></div>
</body>
</html>
