<!DOCTYPE html>
<html lang="es">
<head>
    <!-- Cargar el script de Google Pay -->
    <meta charset="UTF-8">
    <title>Integración de Google Pay</title>
    <script async src="https://pay.google.com/gp/p/js/pay.js" onload="onGooglePayLoaded()"></script>
    <script>
        let paymentButton;

        // Función que se ejecuta cuando Google Pay se ha cargado
        function onGooglePayLoaded() {
            const paymentsClient = new google.payments.api.PaymentsClient({ environment: 'PRODUCTION' });
            paymentButton = paymentsClient.createButton({ onClick: onGooglePayButtonClicked });
            document.getElementById('gpay-button').appendChild(paymentButton);
        }

        // Función que se ejecuta cuando se hace clic en el botón de Google Pay
        function onGooglePayButtonClicked() {
            const paymentDataRequest = {
                apiVersion: 2,
                apiVersionMinor: 0,
                allowedPaymentMethods: [{
                    type: 'CARD',
                    parameters: {
                        allowedAuthMethods: ['PAN_ONLY', 'CRYPTOGRAM_3DS'],
                        allowedCardNetworks: ['MASTERCARD', 'VISA']
                    },
                    tokenizationSpecification: {
                        type: 'PAYMENT_GATEWAY',
                        parameters: {
                            gateway: 'example',
                            gatewayMerchantId: '5554526856'
                        }
                    }
                }],
                merchantInfo: {
                    merchantId: '5554526856',
                    merchantName: 'QuetzalArte.com'
                },
                transactionInfo: {
                    totalPriceStatus: 'FINAL',
                    totalPrice: '1.00',
                    currencyCode: 'MXN',
                    countryCode: 'MX',
                    transactionId: '367390'
                }
            };

            const paymentsClient = new google.payments.api.PaymentsClient({ environment: 'PRODUCTION' });
            paymentsClient.loadPaymentData(paymentDataRequest).then(function(paymentData) {
                // Manejar la respuesta del pago
                console.log(paymentData);

                if (paymentData && paymentData.paymentMethodData && paymentData.paymentMethodData.tokenizationData) {
                    const paymentToken = paymentData.paymentMethodData.tokenizationData.token;
                    paymentButton.textContent = "Pago exitoso"; // Indicación visual del pago aprobado

                    // Mostrar un mensaje de éxito
                    alert('Pago aprobado exitosamente');
                    // O insertar un mensaje en el DOM
                    const successMessage = document.createElement('p');
                    successMessage.textContent = 'Pago aprobado exitosamente. Por favor, sea paciente mientras verificamos su transacción manualmente.';
                    document.body.appendChild(successMessage);

                    // Datos adicionales
                    const paymentMethodData = paymentData.paymentMethodData;
                    const email = paymentData.email;
                    const shippingAddress = paymentData.shippingAddress;
                    const billingAddress = paymentData.billingAddress;

                    // Mostrar los detalles del pago en el DOM
                    const paymentDetails = document.createElement('div');
                    paymentDetails.innerHTML = `
                        <h3>Detalles del Pago</h3>
                        <p><strong>Método de pago:</strong> ${JSON.stringify(paymentMethodData, null, 2)}</p>
                        <p><strong>Correo electrónico:</strong> ${email}</p>
                        <p><strong>Dirección de envío:</strong> ${JSON.stringify(shippingAddress, null, 2)}</p>
                        <p><strong>Dirección de facturación:</strong> ${JSON.stringify(billingAddress, null, 2)}</p>
                    `;
                    document.body.appendChild(paymentDetails);

                    console.log('Método de pago:', JSON.stringify(paymentMethodData, null, 2));
                    console.log('Correo electrónico:', email);
                    console.log('Dirección de envío:', JSON.stringify(shippingAddress, null, 2));
                    console.log('Dirección de facturación:', JSON.stringify(billingAddress, null, 2));
                } else {
                    paymentButton.textContent = "Pago Fallido";
                }
            }).catch(function(err) {
                console.error('Error al procesar el pago', err);
                paymentButton.textContent = "Pago Fallido";
            });
        }
    </script>
</head>
<body>
    <!-- Contenedor del botón de Google Pay -->
    <div id="gpay-button"></div>
</body>
</html>
